function [ xd_new ] = pid_position_controller( x,xd )
%UNTITLED5 此处显示有关此函数的摘要
%   x xd
global KpZ KiZ KdZ KpPhi KiPhi KdPhi KpTheta KiTheta KdTheta KpPsi KiPsi KdPsi KpX KiX KdX KpY KiY KdY
global Ixx Iyy Izz Jtp ct cq l m g h Kr Kparas omegaMax omegaMin
global allocation_matrix allocation_matrix_inv
global displayPhid displayThetad

digits(6);

%% variables
psi = x(11);

error = xd - x;
error = error(1:4); % only the horizonal translation error


Rib = [cos(phi) 0 sin(phi) 0; 0 cos(phi) 0 sin(phi);-sin(phi) 0 cos(phi) 0; 0 -sin(phi) 0 cos(phi)];
error_b = Rib * error;

%% Position controller


Thetad = -1 .* [KpX KdX] * error(1:2);
Phid = [KpX KdX] * error(3:4);

% display([Phid Thetad])

if abs(Thetad) > pi/6 % regulate desire angle
    Thetad =  pi/6 * sign(Thetad);
end

if abs(Phid) > pi/6
    Phid = pi/6 * sign(Phid);
end

xd_new = xd;
xd_new(7) = Phid;
xd_new(9) = Thetad;

%% test
% xd_new(7) = 0;
% xd_new(9) = 0;

end

